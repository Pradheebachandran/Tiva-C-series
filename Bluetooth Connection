#include <stdint.h>
#include "tm4c123gh6pm.h"

void UART0_Init(void);
char UART0_ReadChar(void);
void UART0_WriteChar(char data);
void UART0_WriteString(char *str);

int main(void)
{
    UART0_Init();

    UART0_WriteString("Bluetooth Ready\r\n");

    while (1)
    {
        char c = UART0_ReadChar();  
        UART0_WriteChar(c);         
    }
}

void UART0_Init(void)
{
    SYSCTL->RCGCUART |= 1;      // Enable UART0 clock
    SYSCTL->RCGCGPIO |= 1;      // Enable PORTA clock

    // Wait for ready
    while ((SYSCTL->PRGPIO & 0x01) == 0) {}

    // UART0: PA0 = RX, PA1 = TX
    GPIOA->AFSEL |= 0x03;      
    GPIOA->PCTL  |= 0x11;     
    GPIOA->DEN   |= 0x03;       
    GPIOA->AMSEL &= ~0x03;      

    UART0->CTL &= ~0x01;        
    UART0->IBRD = 104;          
    UART0->FBRD = 11;           
    UART0->LCRH = 0x60;         
    UART0->CTL  = 0x301;      
}

char UART0_ReadChar(void)
{
    while ((UART0->FR & 0x10) != 0);  // Wait until RXFE is 0
    return UART0->DR & 0xFF;
}

void UART0_WriteChar(char data)
{
    while ((UART0->FR & 0x20) != 0);  // Wait until TXFF is 0
    UART0->DR = data;
}

void UART0_WriteString(char *str)
{
    while (*str)
    {
        UART0_WriteChar(*str++);
    }
}
